name: Long Run Logger

run-name: >
  Long Run Logger${{ inputs.correlation_id != '' && format(' ({0})', inputs.correlation_id) || '' }}

on:
  workflow_dispatch:
    inputs:
      correlation_id:
        description: "Optional correlation token to include in logs"
        required: false
        default: ""
        type: string
      iterations:
        description: "Number of log iterations"
        required: false
        default: "10"
        type: string
      sleep_seconds:
        description: "Seconds to sleep between log entries"
        required: false
        default: "5"
        type: string

jobs:
  logger:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - name: Announce run
        run: |
          echo "Starting long-running logger"
          if [[ -n "${{ inputs.correlation_id }}" ]]; then
            echo "Correlation ID: ${{ inputs.correlation_id }}"
          fi

      - name: Emit periodic logs
        env:
          ITERATIONS: ${{ inputs.iterations }}
          SLEEP_SECONDS: ${{ inputs.sleep_seconds }}
          CORRELATION_ID: ${{ inputs.correlation_id }}
        run: |
          ITERATIONS=${ITERATIONS:-10}
          SLEEP_SECONDS=${SLEEP_SECONDS:-5}
          for i in $(seq 1 "${ITERATIONS}"); do
            timestamp="$(date --iso-8601=seconds)"
            if [[ -n "${CORRELATION_ID}" ]]; then
              echo "[${timestamp}] iteration ${i} correlation=${CORRELATION_ID}"
            else
              echo "[${timestamp}] iteration ${i}"
            fi
            sleep "${SLEEP_SECONDS}"
          done

      - name: Complete
        run: echo "Long-running logger finished."
